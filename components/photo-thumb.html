<!-- Defines element markup -->
<template>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css">
  <div class="card hoverable small">
    <div class="card-image">
      <img src="" alt="" />
      <span class="card-title"></span>
    </div>
    <div class="card-content">
      <p>This photo could be of anything, but faces help prove a point.</p>
    </div>
    <div class="card-action">
      <a class="photo-view" href="" title="">Go Big</a>
    </div>
  </div>
</template>
<script>
(function(window, document, undefined) {

    // Refers to the "importer", which is index.html
    var thatDoc = document;

    // Refers to the "importee", which is src/hello-world.html
    var thisDoc =  (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

    // Gets content from <template>
    var template = thisDoc.querySelector('template').content;

    // Creates an object based in the HTML Element prototype
    var MyElementProto = Object.create(HTMLElement.prototype);

    // Creates the "imageUrl" attribute and sets a default value
    MyElementProto.publicId = 'cloudinary_logo';
    MyElementProto.imageUrl = 'cloudinary_logo';
    MyElementProto.imageName = 'cloudinary_logo';

    // Fires when an instance of the element is created
    MyElementProto.createdCallback = function() {
        // Creates the shadow root
        var shadowRoot = this.createShadowRoot();

        // Adds a template clone into shadow root
        var clone = thatDoc.importNode(template, true);
        shadowRoot.appendChild(clone);

        // Caches <strong> DOM query
        this.imageContainer = shadowRoot.querySelector('img');
        this.nameContainer = shadowRoot.querySelector('span');
        this.viewContainer = shadowRoot.querySelector('a');

        // Checks if the "image-url" attribute has been overwritten
        if (this.hasAttribute('public-id')) {
            var publicId = this.getAttribute('public-id');
            this.setPublicId(publicId);
        }
        else {
            this.setPublicId(this.imageUrl);
        }

        // Checks if the "image-url" attribute has been overwritten
        if (this.hasAttribute('image-url')) {
            var imageUrl = this.getAttribute('image-url');
            this.setImageUrl(imageUrl);
        }
        else {
            this.setImageUrl(this.imageUrl);
        }

        // Checks if the "image-name" attribute has been overwritten
        if (this.hasAttribute('image-name')) {
            var imageName = this.getAttribute('image-name');
            this.setImageName(imageName);
        }
        else {
            this.setImageName(this.imageName);
        }

        // Handle the button's click event
        this.viewContainer.addEventListener('click', this.fireBtn.bind(this));
    };

    // Fires when an attribute was added, removed, or updated
    MyElementProto.attributeChangedCallback = function(attr, oldVal, newVal) {
        if (attr === 'public-id') {
            this.setPublicId(newVal);
        }
        if (attr === 'image-url') {
            this.setImageUrl(newVal);
        }
        if (attr === 'image-name') {
            this.setImageName(newVal);
        }
    };

    // Sets new value to "image-url" attribute
    MyElementProto.setPublicId = function(val) {
        this.publicId = val;

        // Sets "public-id" value into <strong>
        this.viewContainer.href = this.publicId;
    };

    // Sets new value to "image-url" attribute
    MyElementProto.setImageUrl = function(val) {
        this.imageUrl = val;

        // Sets "public-id" value into <strong>
        this.imageContainer.src = this.imageUrl;
    };

    // Sets new value to "image-url" attribute
    MyElementProto.setImageName = function(val) {
        this.imageName = val;

        // Sets "public-id" value into <strong>
        this.imageContainer.alt = this.imageName;
        this.nameContainer.textContent = this.imageName;
        this.viewContainer.title = this.imageName;
    };

    // Dispatch a custom event when the button is clicked
    MyElementProto.fireBtn = function(e) {
      e.preventDefault();
      this.dispatchEvent(new Event('btn-clicked'));
    };

    // Registers <photo-thumb> in the main document
    window.MyElement = thatDoc.registerElement('photo-thumb', {
        prototype: MyElementProto
    });

    // Loaded
    console.log('Loaded: photo-thumb');
})(window, document);
</script>
